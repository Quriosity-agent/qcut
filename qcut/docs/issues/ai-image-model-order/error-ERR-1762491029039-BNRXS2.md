# Error Report: ERR-1762491029039-BNRXS2

- **Timestamp**: _add when reproduced_
- **Environment**: QCut desktop (Electron) – `app://` bundle
- **Area**: AI Images › Model Type Toggle (Text2ImageView)

## Symptom
Switching into the updated AI Images view triggers a fatal React error:

```
Error ID: ERR-1762491029039-BNRXS2
Error: Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.
    at UF (app://./assets/vendor-react-waUpj2M3.js:178:760)
    at wn (app://./assets/vendor-react-waUpj2M3.js:174:16163)
    at L3 (app://./assets/vendor-react-waUpj2M3.js:143:10956)
    at app://./assets/vendor-react-waUpj2M3.js:291:38165
    at N_ (app://./assets/vendor-react-waUpj2M3.js:242:5848)
    at app://./assets/vendor-react-waUpj2M3.js:242:5940
    at Array.map (<anonymous>)
    at app://./assets/vendor-react-waUpj2M3.js:242:5924
    at N_ (app://./assets/vendor-react-waUpj2M3.js:242:5848)
    at app://./assets/vendor-react-waUpj2M3.js:242:5940
```

## Notes / Leads
- Likely tied to a state update loop in the new `ModelTypeSelector`/`UpscaleSettings` interaction or the store auto-selection logic.
- Occurs immediately after the component renders, before user interaction (per reporter), indicating `useEffect` or render-time setters.
- Check `useText2ImageStore.setModelType` and the `setUpscaleSettings` logic for setState cascades.

## Impacted Files
- `qcut/apps/web/src/components/editor/media-panel/views/text2image.tsx`
- `qcut/apps/web/src/components/editor/media-panel/views/model-type-selector.tsx`
- `qcut/apps/web/src/components/editor/media-panel/views/upscale-settings.tsx`
- `qcut/apps/web/src/stores/text2image-store.ts`
- `qcut/apps/web/src/components/editor/media-panel/views/use-upscale-generation.ts`

## Investigation Subtasks
1. **Understand the error**
   - Reproduce the crash in the desktop build with React DevTools open to capture the cascading `setState` calls.
   - Confirm whether the loop begins when `modelType` transitions to `"upscale"` or if it is triggered earlier by store listeners.
2. **Read the relevant code**
   - Trace state transitions across the impacted files above, focusing on effects that set store values during render.
   - Document any circular dependency between `setModelType`, `setUpscaleSettings`, and the `useUpscaleGeneration` hook.
3. **Propose a fix**
   - Outline guard conditions (e.g., short-circuiting setters when the requested value already matches state) and where they should live.
   - Break the proposal into code-level subtasks (store guard, selector cleanup, hook effect refactor) so implementation can proceed stepwise.

_Attach additional context or logs to this file as findings arrive._
